# TCP/IP

Transmission Control Protocol / Internet Protocol）は通信を実現する基盤技術

中でも「通信の信頼性を確保する」役割を担っているのがTCP

# TCPとは

TCPは「コネクション型」と分類され、送受信を行う機器間で通信の開始と終了を確認する。データ転送時には、送信側はデータを送信し、受信側はそれに対する確認応答であるACK（Acknowledgement）を返すことによって、両端のホスト間でデータが届いたかどうかを確認し合いながら確実にデータ転送を行う。

![OSI参照モデル](https://cdn-ak.f.st-hatena.com/images/fotolife/b/blog-media/20200205/20200205164620.png)

OSI参照モデルではトランスポート層にあたる。

## 特徴

通常、データの送信単位にはデータ部とヘッダ部があり、ヘッダは各階層ごとにフォーマットが規定されている。

TCPでは、両ホストはトランスポート層のヘッダのみを参照し、通信のやりとりを行う。通信する両者が同時にデータを送受信可能である全二重通信を提供

- TCPでは送信単位のことを「セグメント」と呼ぶ
- セグメントが何番目まで送られたかを示すシーケンス番号
- 何番目まで受け取りました/次は何番目が欲しい」ということを示す確認応答番号
「受信可能なセグメント量」を示すウィンドウサイズ
## コネクション管理

### コネクションの確立　3ウェイハンドシェイク

1. 送信側から確立要求としてSYN(synchronize)（コネクションの確立要求）フラグの有効化されたTCPパケットを送信
2. 受信側はこれに対するACK(Acknowledgement)と、同時に受信側からの接続確立要求として同TCPヘッダのSYNフラグを有効化して送信（SYN+ACK）
3. 送信側が受信側からのSYNに対するACKパケットを送信

### コネクションの切断：ハーフクローズ

1. 送信側は最初にFIN（コネクション終了要求）を送信
2. 受信側はACKを送信し、続けてFINを送信
3. 送信側はFINを受信して最後のACKを送った後、一定時間待ってコネクション終了
### ウィンドウ制御

TCPの送信側では、一度に転送可能なデータ量を表すパラメータであるウィンドウサイズ（swnd）が定義されている。
ウィンドウ内にあるセグメントはACKを待たずに送信することができる。

ウィンドウ制御」が上位概念に相当し、スライディングウィンドウ方式に基づいてデータの転送を行う、というもの。送信ウィンドウサイズswndを決定するための方法が「フロー制御」と「輻輳制御」となる。
フロー制御は受信側から通知される受け入れ可能なウィンドウサイズrwndに基づいて送信ウィンドウサイズswndを決定するもの。輻輳制御は、ネットワークの輻輳をできるだけ抑えつつ、かつ効率よくデータを転送することを目的とし輻輳ウィンドウサイズcwndを決定するもの。 rwndがcwndよりも小さければ、rwndを優先的に採用する。

### フロー制御

二つの機器間でデータのやり取りを行う場合、相手から受信したデータはバッファメモリにいったん記録され、その後プロセッサから読み出されて処理される。
このとき、送信が速過ぎてバッファからあふれそうになったり、受信側が何らかの処理に忙しくてデータの処理を進められない場合などに、送信側の機器にこれを通知して、送信を一時中断したり、速度を低下させたりする。こうしたデータの流れの調整をフロー制御という。

### 輻輳制御

ネットワークの混雑（輻輳、ふくそうと言います）をできるだけ回避するような送信セグメント量の制御をおこなう。

## 参考

https://eh-career.com/engineerhub/entry/2020/02/13/103000
